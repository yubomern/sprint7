<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Socket.IO Chat</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #chat { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
        .msg { margin-bottom: 8px; }
        .msg span { font-weight: bold; }
    </style>
</head>
<body>
<h2>Socket.IO Chat</h2>

<div>
    <label>Your User ID:</label>
    <input type="text" id="userId">
    <button onclick="connectUser()">Connect</button>
</div>

<div id="chat"></div>

<div>
    <input type="text" id="receiverId" placeholder="Receiver ID">
    <input type="text" id="messageInput" placeholder="Type message">
    <button onclick="sendMessage()">Send</button>
</div>

<script>
    let socket;
    let myUserId;

    function connectUser() {
        myUserId = document.getElementById('userId').value.trim();
        if (!myUserId) {
            alert('Enter your User ID');
            return;
        }

        socket = io("http://127.0.0.1:1002");

        socket.on("connect", () => {
            console.log("Connected to server");
            socket.emit("addUser", myUserId);
        });

        socket.on("getUsers", (users) => {
            console.log("Online users:", users);
        });

        socket.on("getMessage", (message) => {
            displayMessage(message.senderId, message.text);
        });
    }

    function sendMessage() {
        const receiverId = document.getElementById('receiverId').value.trim();
        const text = document.getElementById('messageInput').value.trim();

        if (!receiverId || !text) {
            alert('Enter receiver ID and message');
            return;
        }

        socket.emit("sendMessage", {
            senderId: myUserId,
            recieverId: receiverId,
            text: text,
            images: []
        });

        displayMessage("Me", text);
        document.getElementById('messageInput').value = '';
    }

    function displayMessage(sender, text) {
        const chatBox = document.getElementById('chat');
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('msg');
        msgDiv.innerHTML = `<span>${sender}:</span> ${text}`;
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
